<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Twurple</title>
    <style>
    	@import url('https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap');

		html {
			height: 100%;
		}

		html, body, #app-root {
			width: 100%;
			display: flex;
			flex: 1;
			flex-direction: column;
		}
		
		body {
			margin: 0;
			padding: 0;
			font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
			font-size: 14px;
			line-height: 1.6em;
			background: #141414;
			color: #b9b9b9;
		}
		
		svg:not(:root).svg-inline--fa {
  overflow: visible;
}

.svg-inline--fa {
  display: inline-block;
  font-size: inherit;
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.225em;
}
.svg-inline--fa.fa-w-1 {
  width: 0.0625em;
}
.svg-inline--fa.fa-w-2 {
  width: 0.125em;
}
.svg-inline--fa.fa-w-3 {
  width: 0.1875em;
}
.svg-inline--fa.fa-w-4 {
  width: 0.25em;
}
.svg-inline--fa.fa-w-5 {
  width: 0.3125em;
}
.svg-inline--fa.fa-w-6 {
  width: 0.375em;
}
.svg-inline--fa.fa-w-7 {
  width: 0.4375em;
}
.svg-inline--fa.fa-w-8 {
  width: 0.5em;
}
.svg-inline--fa.fa-w-9 {
  width: 0.5625em;
}
.svg-inline--fa.fa-w-10 {
  width: 0.625em;
}
.svg-inline--fa.fa-w-11 {
  width: 0.6875em;
}
.svg-inline--fa.fa-w-12 {
  width: 0.75em;
}
.svg-inline--fa.fa-w-13 {
  width: 0.8125em;
}
.svg-inline--fa.fa-w-14 {
  width: 0.875em;
}
.svg-inline--fa.fa-w-15 {
  width: 0.9375em;
}
.svg-inline--fa.fa-w-16 {
  width: 1em;
}
.svg-inline--fa.fa-w-17 {
  width: 1.0625em;
}
.svg-inline--fa.fa-w-18 {
  width: 1.125em;
}
.svg-inline--fa.fa-w-19 {
  width: 1.1875em;
}
.svg-inline--fa.fa-w-20 {
  width: 1.25em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-border {
  height: 1.5em;
}
.svg-inline--fa.fa-li {
  width: 2em;
}
.svg-inline--fa.fa-fw {
  width: 1.25em;
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: #ff253a;
  border-radius: 1em;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  color: #fff;
  height: 1.5em;
  line-height: 1;
  max-width: 5em;
  min-width: 1.5em;
  overflow: hidden;
  padding: 0.25em;
  right: 0;
  text-overflow: ellipsis;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: 0;
  right: 0;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: 0;
  left: 0;
  right: auto;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  right: 0;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: 0;
  right: auto;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-lg {
  font-size: 1.3333333333em;
  line-height: 0.75em;
  vertical-align: -0.0667em;
}

.fa-xs {
  font-size: 0.75em;
}

.fa-sm {
  font-size: 0.875em;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: 2.5em;
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: -2em;
  position: absolute;
  text-align: center;
  width: 2em;
  line-height: inherit;
}

.fa-border {
  border: solid 0.08em #eee;
  border-radius: 0.1em;
  padding: 0.2em 0.25em 0.15em;
}

.fa-pull-left {
  float: left;
}

.fa-pull-right {
  float: right;
}

.fa.fa-pull-left,
.fas.fa-pull-left,
.far.fa-pull-left,
.fal.fa-pull-left,
.fab.fa-pull-left {
  margin-right: 0.3em;
}
.fa.fa-pull-right,
.fas.fa-pull-right,
.far.fa-pull-right,
.fal.fa-pull-right,
.fab.fa-pull-right {
  margin-left: 0.3em;
}

.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
          animation: fa-spin 2s infinite linear;
}

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
          animation: fa-spin 1s infinite steps(8);
}

@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}

@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical,
:root .fa-flip-both {
  -webkit-filter: none;
          filter: none;
}

.fa-stack {
  display: inline-block;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: #fff;
}

.sr-only {
  border: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.sr-only-focusable:active, .sr-only-focusable:focus {
  clip: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  position: static;
  width: auto;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse {
  color: #fff;
}

	</style>
    <style id="server-side-styles">.jss19 {
  position: relative;
}
.jss20 {
  top: 8px;
  right: 8px;
  border: 1px solid #444;
  display: flex;
  opacity: 0;
  position: absolute;
  transition: opacity .5s ease-in-out;
  pointer-events: none;
}
.jss19:hover .jss20 {
  opacity: 1;
  pointer-events: auto;
}
.jss21 {
  display: none;
}
.jss22 {
  cursor: pointer;
  padding: 8px;
  transition: background-color .3s ease-in-out;
  border-left: 1px solid #444;
}
.jss22:first-of-type {
  border-left: 0 none;
}
input:checked + .jss22 {
  background: #444;
}
.jss23 {
  display: block;
  background-color: rgba(9, 180, 50, 0.25);
}
.jss24 {
  display: block;
  background-color: rgba(255, 106, 105, 0.25);
}
.jss15 table {
  border-collapse: collapse;
}
.jss15 th, .jss15 td {
  border: 1px solid #444;
  padding: 8px;
}
.jss15 li {
  margin: 16px 0;
}
.jss15 li::marker {
  color: #647d0f;
}
.jss16 {
  color: inherit;
  transition: border-color .3s ease-in-out;
  font-weight: bold;
  border-bottom: 1.5px solid #647d0f;
  text-decoration: none;
}
.jss16:hover {
  border-bottom-color: #88ab14;
}
.jss17 {
  display: flow-root;
  padding: 0 1em;
  border-left: 4px solid #ab9120;
  margin-bottom: 1em;
  background-color: #242424;
}
.jss18 {
  font-size: 1em;
}
.jss14 {
  padding: 16px;
}
.jss14 h2 {
  margin: 24px 0 16px;
}
.jss14 h2:first-child {
  margin-top: 0;
}
.jss13 {
  color: #b9b9b9;
  padding: 16px;
  position: relative;
  background-color: #242424;
}
.jss13 h1 {
  margin: 0;
  display: inline;
  font-size: 1.5em;
  font-weight: normal;
}
.jss13 p {
  margin: 0;
}
.jss10 {
  flex: 1;
  display: flex;
  flex-direction: row;
}
.jss11 {
  width: 250px;
}
.jss12 {
  flex: 1;
}
.jss1 {
  display: flex;
  border-bottom: 1px solid #444;
}
.jss2 {
  color: #b9b9b9;
  cursor: pointer;
  margin: 0 8px;
  padding: 8px;
  transition: background-color .3s ease-in-out, border-color .3s ease-in-out;
  line-height: 1.3em;
  user-select: none;
  border-bottom: 3px solid transparent;
  text-decoration: none;
}
.jss2:hover {
  background-color: #333333;
}
.jss3 {
  background-color: #242424;
  border-bottom-color: #647d0f;
}
.jss3:hover {
  border-bottom-color: #88ab14;
}
.jss4 {
  font-weight: bold;
  margin-left: 0;
}
.jss5 {
  margin: 0 8px;
  position: relative;
}
.jss5 > .jss2 {
  margin: 0;
}
.jss5:hover .jss6 {
  display: block;
}
.jss6 {
  top: 100%;
  left: 0;
  border: 1px solid #444;
  display: none;
  z-index: 4;
  position: absolute;
  background-color: #141414;
}
.jss7 {
  margin: 0;
  display: block;
  border-left: 3px solid transparent;
  border-right: 0 none;
  border-bottom: 0 none;
}
.jss7:first-child {
  border-top: 0 none;
}
.jss8 {
  background-color: #242424;
  border-left-color: #647d0f;
}
.jss8:hover {
  border-left-color: #88ab14;
}
.jss9 {
  flex: 1;
}</style>
</head>
<body>
<div id="app-root"><div class="jss1"><a class="jss2 jss4" href="/versions/main/">Twurple</a><a class="jss2" href="/versions/main/docs/auth/">Authentication</a><a class="jss2" href="/versions/main/docs/getting-data/">Getting data</a><a class="jss2" href="/versions/main/docs/examples/">Examples</a><a aria-current="page" class="jss2 jss3" href="/versions/main/docs/faq/">FAQ</a><a class="jss2" href="/versions/main/docs/migration/">Migration</a><div class="jss5"><div class="jss2">Reference</div><div class="jss6"><a class="jss2 jss7" href="/versions/main/reference/api/">api</a><a class="jss2 jss7" href="/versions/main/reference/api-call/">api-call</a><a class="jss2 jss7" href="/versions/main/reference/auth/">auth</a><a class="jss2 jss7" href="/versions/main/reference/auth-ext/">auth-ext</a><a class="jss2 jss7" href="/versions/main/reference/auth-tmi/">auth-tmi</a><a class="jss2 jss7" href="/versions/main/reference/chat/">chat</a><a class="jss2 jss7" href="/versions/main/reference/common/">common</a><a class="jss2 jss7" href="/versions/main/reference/easy-bot/">easy-bot</a><a class="jss2 jss7" href="/versions/main/reference/ebs-helper/">ebs-helper</a><a class="jss2 jss7" href="/versions/main/reference/eventsub/">eventsub</a><a class="jss2 jss7" href="/versions/main/reference/pubsub/">pubsub</a></div></div><div class="jss9"></div><div data-dynamic-component="VersionMenu"></div></div><div class="jss10"><div class="jss12"><div class="jss13"><h1>Frequently asked questions (FAQ)</h1></div><div class="jss14"><div class="jss15"><h2>I&#x27;m trying to make my bot say something / join channels right after connecting, but awaiting the <code>connect()</code> Promise / listening to the <code>onConnect</code> event doesn&#x27;t work.</h2>
<p>Twitch uses the IRC protocol as foundation for its chat. In this protocol, after connection,
you must tell the server your name and (optionally) authenticate before you can send messages to channels.
The IRC specification calls this process &quot;registration&quot;.</p>
<p>The base library we use for the <code>ChatClient</code> is an IRC library that has terminology very close to the IRC specification.
This means that <code>onConnect</code> will happen before the registration step,
which in turn means that you can&#x27;t join channels or send messages yet in a listener for that event.</p>
<p>Similarly, awaiting the Promise returned by <code>connect()</code> also has this problem of being too early,
and has the additional downside that your code will only run when the client connects for the first time,
and does not re-run when you reconnect due to connection instability.</p>
<p>Instead, you should use the <code>onRegister</code> event to send messages.</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code class="language-ts" style="white-space:pre-wrap"><span><span>chatClient.onRegister(</span><span class="hljs-function">() =&gt;</span><span> {
</span></span><span><span>	chatClient.say(</span><span style="color:#6a8759">&#x27;someone&#x27;</span><span>, </span><span style="color:#6a8759">&#x27;Hello, I\&#x27;m now connected!&#x27;</span><span>);
</span></span><span>})
</span></code></pre></pre>
<p>For joining channels, the <code>channels</code> option exists in the constructor of the <code>ChatClient</code> class.
You can even pass an async function to it to dynamically access a possibly changing set of channels:</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code class="language-ts" style="white-space:pre-wrap"><span><span style="color:#cb7832">const</span><span> chatClient = </span><span style="color:#cb7832">new</span><span> ChatClient({
</span></span><span>	authProvider,
</span><span><span>	</span><span class="hljs-attr">channels</span><span>: </span><span style="color:#cb7832">async</span><span> () =&gt; </span><span style="color:#cb7832">await</span><span> someDatabase.select(</span><span style="color:#6a8759">&#x27;twitchUsername&#x27;</span><span>).from(</span><span style="color:#6a8759">&#x27;users&#x27;</span><span>).fetchAll().map(</span><span class="hljs-function" style="color:#b9b9b9">u</span><span class="hljs-function"> =&gt;</span><span> u.twitchUsername)
</span></span><span>})
</span></code></pre></pre>
<h2>Why does <code>EventSubMiddleware</code> show the error &quot;The request body was already consumed by something else&quot;, and how do I fix it?</h2>
<p>This happens because you&#x27;re using conflicting middleware that parses the body, such as:</p>
<ul>
<li><code>body-parser</code></li>
<li><code>express.json()</code></li>
<li><code>express.raw()</code></li>
</ul>
<p>Many popular express tutorials (in fact, even the official documentation of <code>express</code>!)
tell you to apply these body parsers for all requests, like so:</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code class="language-js" style="white-space:pre-wrap"><span><span style="color:#cb7832">const</span><span> express = </span><span style="color:#e0c46c">require</span><span>(</span><span style="color:#6a8759">&#x27;express&#x27;</span><span>);
</span></span><span>
</span><span><span></span><span style="color:#cb7832">const</span><span> app = express();
</span></span><span><span>app.use(express.json()); </span><span style="color:#7f7f7f">// don&#x27;t do this!</span><span>
</span></span><span>
</span><span><span>app.get(</span><span style="color:#6a8759">&#x27;/&#x27;</span><span>, </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#b9b9b9">req, res</span><span class="hljs-function">) =&gt;</span><span> res.send(</span><span style="color:#6a8759">&#x27;Hello World&#x27;</span><span>));
</span></span><span><span>app.post(</span><span style="color:#6a8759">&#x27;/echo-prop&#x27;</span><span>, </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#b9b9b9">req, res</span><span class="hljs-function">) =&gt;</span><span> res.send(req.body.prop));
</span></span><span>
</span><span><span>app.listen(</span><span style="color:#6896ba">3000</span><span>);</span></span></code></pre></pre>
<p>This code applies the JSON parser middleware for all requests.
That means that you have a JSON-parsed object in <code>req.body</code> at all times.<br/>
<!-- -->Sadly, it also means that we can&#x27;t read the raw body from the request anymore,
since it is already consumed by that middleware.</p>
<p>You might ask: &quot;Why can&#x27;t you just use <code>req.body</code> if it already exists in a parsed form?&quot;<br/>
<!-- -->The answer to this is that we need access to the raw body in order to match its signature.<br/>
<!-- -->In order to verify that the request really came from Twitch,
they sign the request using the secret that was passed at subscription time.<br/>
<!-- -->If we re-encode the JSON payload in <code>req.body</code> rather than using the raw data,
the result might be slightly mismatched in formatting, which breaks the signature.</p>
<p>The proper way to use body parser middleware is to apply them where you actually expect JSON <em>input</em>
(as opposed to returning JSON):</p>
<pre><pre style="display:block;overflow-x:auto;padding:0.5em;background:#2b2b2b;color:#bababa"><code class="language-js" style="white-space:pre-wrap"><span><span style="color:#cb7832">const</span><span> express = </span><span style="color:#e0c46c">require</span><span>(</span><span style="color:#6a8759">&#x27;express&#x27;</span><span>);
</span></span><span>
</span><span><span></span><span style="color:#cb7832">const</span><span> app = express();
</span></span><span>
</span><span><span>app.get(</span><span style="color:#6a8759">&#x27;/&#x27;</span><span>, </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#b9b9b9">req, res</span><span class="hljs-function">) =&gt;</span><span> res.send(</span><span style="color:#6a8759">&#x27;Hello World&#x27;</span><span>));
</span></span><span><span>app.post(</span><span style="color:#6a8759">&#x27;/echo-prop&#x27;</span><span>, express.json(), </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#b9b9b9">req, res</span><span class="hljs-function">) =&gt;</span><span> res.send(req.body.prop));
</span></span><span>
</span><span><span>app.listen(</span><span style="color:#6896ba">3000</span><span>);</span></span></code></pre></pre>
<h2>My <code>EventSubListener</code> or <code>EventSubMiddleware</code> starts up correctly, but it never tells me about successful subscriptions, why?</h2>
<p>This can have different reasons:</p>
<ul>
<li>If you run a reverse proxy in front of the listener, make sure it forwards the requests properly.
The listener expects the <code>pathPrefix</code> to be stripped from the received URL.<br/>
<!-- -->Consult your reverse proxy&#x27;s logs and <a class="jss16" href="/versions/main/docs/getting-data/logging/configuration.html">set up logging for the listener</a> as well.</li>
<li>Make sure your SSL is set up properly.
In particular, you need to make sure you&#x27;re using a trusted certificate (self-signed won&#x27;t work)
and that you&#x27;re passing the full certificate chain.<br/>
<!-- -->A good way to test your SSL setup is <a class="jss16" href="https://www.ssllabs.com/ssltest">the Qualys SSL Labs test</a>.
It will make sure you find all trust and chain issues.</li>
</ul>
<h2>EventSub: What does the error message <code>subscription missing proper authorization</code> mean?</h2>
<p>EventSub uses app tokens to create subscriptions. App tokens can&#x27;t have any scopes.<br/>
<!-- -->However, that doesn&#x27;t mean that authorization isn&#x27;t necessary at all.
Twitch will check with its internal systems whether the user ever authorized the necessary scope for the topic
and give you the mentioned error message when it fails to find this authorization.</p>
<p>To get this authorization, simply <a class="jss16" href="https://dev.twitch.tv/docs/authentication/getting-tokens-oauth/">go through OAuth</a>
(except the Client Credentials flow) with your client ID and the
<a class="jss16" href="https://dev.twitch.tv/docs/eventsub/eventsub-subscription-types">necessary scopes</a> that are documented
for your desired subscription topics. You can throw away the token you get from this.
The authorization will still get saved on Twitch - now you can subscribe to your topics.</p></div></div></div></div></div>
<script src="/versions/main/pe.js"></script>
</body>
</html>